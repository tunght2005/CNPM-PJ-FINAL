<script>
    document.addEventListener("DOMContentLoaded", function () {
      // Khởi tạo giỏ hàng và giao diện
      updateCartCount();
    });
    // Cập nhật số lượng giỏ hàng
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.querySelector(".number-cart").textContent = totalItems;
    }
</script>  
<!-- Header -->
<header class="header">
    <div class="container">
      <div class="right-info">
        <a href="#"><i class="fa-solid fa-users"></i>Quan Hệ Cổ Đông</a>
        <a href="{% url 'diamond_page' %}"><i class="fa-solid fa-map-location-dot"></i>Cửa Hàng</a>
        <a href="#"><i class="fa-solid fa-headset"></i>Hotline: 18000xxxx</a>
      </div>
      <a href="{% url 'home_page' %}"
        ><img src="{%static 'home/assets/img/img-main/logo-page.jpg' %}" alt="" class="logo-header"
      /></a>
      <div class="left-info-shop">
      {% if request.session.user_id %}
        <a href="{% url 'customer_page' %}" class="user-card">
            <i class="fa-solid fa-user"></i> {{ request.session.user_name }}
        </a>
      {% else %}
        <a href="{% url 'login' %}" class="user-card">
              <i class="fa-solid fa-user"></i> Đăng nhập
        </a>
      {% endif %} 
        <a href="{% url 'cart_page' %}" class="cart-shop">
          <img
            style="width: 20px; height: auto"
            src="https://cdn.pnj.io/images/image-update/layout/icon-cart-new.svg"
            alt=""
          />
          <span>Giỏ Hàng</span><span class="number-cart">0</span></a
        >
      </div>
    </div>
    <hr />
    <nav class="nav-menu">
      <ul>
        <li>
          <a href="{% url 'jewelry_page' %}" class="menu-item" id="item-1">Trang Sức</a>
          <!-- Sub Menu -->
          <div class="sub-menu-1">
            <div class="type-menu">
              <span>Chủng Loại</span>
              <a href="#">Nhẫn</a><a href="#">Bông Tai</a><a href="#">Lắc</a
              ><a href="#">Vòng</a><a href="#">Dây Chuyền</a>
            </div>
            <div class="material-menu">
              <span>Chất Liệu</span>
              <a href="#">Vàng</a>
              <a href="#">Bạc</a>
            </div>
            <div class="product-line">
              <span>Dòng Hàng</span>
              <a href="#">Trang Sức Đính Kim Cương</a
              ><a href="#">Trang Sức Không Đính Đá</a
              ><a href="#">Kim Cương Viên</a>
            </div>
            <div class="style-menu">
              <span>Trang Sức Phong Thuỷ</span>
              <a href="#">Trang Sức Theo Cung & Mệnh</a
              ><a href="#">Best Seller</a><a href="#">Hàng Đặt Trước</a>
            </div>
            <img
              src="https://cdn.pnj.io/images/2024/11/vuondasac-t12-400x270CTA.png"
              alt=""
              style="width: 300px; height: auto"
            />
          </div>
        </li>
        <li>
          <a href="{% url 'wedding_page' %}" class="menu-item" id="item-2">Trang Sức Cưới</a>
          <!-- Sub Menu 2-->
          <div class="sub-menu-2">
            <div class="purpose-menu">
              <span>Theo Mục Đích</span>
              <a href="#">Cầu Hôn</a><a href="#">Kết Hôn</a
              ><a href="#">Kỷ Niệm</a>
            </div>
            <div class="type-menu">
              <span>Chủng Loại</span>
              <a href="#">Nhẫn</a><a href="#">Bông Tai</a><a href="#">Lắc</a
              ><a href="#">Vòng Tay</a><a href="#">Dây Chuyền</a>
            </div>
            <div class="product-line">
              <span>Dòng Trang Sức</span>
              <a href="#">Kim Cương</a><a href="#">Không Đính Đá</a
              ><a href="#">Đá Màu</a>
            </div>
            <div class="material-menu">
              <span>Chất Liệu</span>
              <a href="#">Vàng 24k</a>
              <a href="#">Vàng 18k</a>
            </div>
            <img
              src="https://cdn.pnj.io/images/2024/10/trau-cau-08-10-24-Banner_BST_TC_KC_400x270.png"
              alt=""
              style="width: 300px; height: auto"
            />
          </div>
        </li>
        <li>
          <a href="{% url 'watch_page' %}" class="menu-item" id="item-3">Đồng Hồ</a>
          <!-- Sub Menu 3-->
          <div class="sub-menu-3">
            <div class="branch-menu">
              <span>Thương Hiệu Nhật Bản</span>
              <a href="#">Casio</a><a href="#">Orient</a
              ><a href="#">Citizen</a>
            </div>
            <div class="type-menu">
              <span>Chủng Loại</span>
              <a href="#">Hàng Đặt Trước</a><a href="#">Đồng Hồ</a
              ><a href="#">Đồng Hồ Cặp</a>
            </div>
            <div class="gener-menu">
              <span>Giới Tính</span>
              <a href="#">Nam</a>
              <a href="#">Nữ</a>
            </div>
            <img
              src="https://cdn.pnj.io/images/promo/216/PNJ-Watch-post-1-3.png"
              alt=""
              style="width: 300px; height: auto"
            />
          </div>
        </li>
        <li>
          <a href="{% url 'gift_page' %}" class="menu-item" id="item-4">Quà Tặng</a>
          <!-- Sub Menu 4-->
          <div class="sub-menu-4">
            <div class="gift-menu">
              <span>Gợi Ý Quà Tặng</span>
              <a href="#">Cho Người Lớn</a><a href="#">Cho Trẻ Em</a>
            </div>
            <div class="type-menu">
              <span>Quà Tặng Mỹ Nghệ</span>
              <a href="#">Tượng Phong Thuỷ</a><a href="#">Tranh Phong Thuỷ</a>
            </div>
            <img
              src="https://cdn.pnj.io/images/2024/09/DW_Navigation_Bar_CTA_400x270.png"
              alt=""
              style="width: 300px; height: auto"
            />
          </div>
        </li>
        <li>
          <a href="#" class="menu-item" id="item-5">Thương Hiệu</a>
          <div class="sub-menu-5">
            <div class="branch-menu">
              <div class="box">
                <img
                  src="https://cdn.pnj.io/images/image-update/layout/iconhotdeal-new.svg"
                  alt=""
                  class="icon-search"
                  style="width: 15px; height: auto"
                />
                <span>Thương Hiệu</span>
              </div>
              <div class="image">
                <a href="#"
                  ><img
                    src="https://cdn.pnj.io/images/2023/relayout-pdp/mencode-thuonghieu-logo.svg"
                    alt=""
                    style="width: 100px; height: 50px" /></a
                ><a href="#"
                  ><img
                    src="https://cdn.pnj.io/images/2023/brand-search-bar/watch.svg"
                    alt=""
                    style="width: 100px; height: 50px" /></a
                ><a href="#"
                  ><img
                    src="https://cdn.pnj.io/images/2023/brand-search-bar/style.svg"
                    alt=""
                    style="width: 100px; height: 50px" /></a
                ><a href="#"
                  ><img
                    src="https://cdn.pnj.io/images/2023/brand-search-bar/disney.svg"
                    alt=""
                    style="width: 100px; height: 50px"
                /></a>
              </div>
            </div>
          </div>
        </li>
        <li>
          <a href="{% url 'blog_page' %}" class="menu-item">Blog</a>
        </li>
        <li>
          <a href="{% url 'sales_page' %}" class="menu-item">Khuyến Mãi</a>
        </li>
        <input type="search" id="search-menu" placeholder="Tìm Kiếm Nhanh" />
      </ul>
    </nav>
</header>
<!-- Search -->
<div class="search">
    <div class="wrap-search">
      <div class="search-container">
        <div class="search-bar">
          <button id="search-btn">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
          <input type="text" id="search-input" placeholder="Tìm kiếm..." />
          <span id="search-btn-cancel">x</span>
        </div>
        <div class="search-main">
          <div class="content-sale">
            <div class="box">
              <img
                src="https://cdn.pnj.io/images/image-update/layout/iconhotdeal-new.svg"
                alt=""
                class="icon-search"
                style="width: 15px; height: auto"
              />
              <h4>Ưu đãi online</h4>
            </div>
            <div class="tags">
              <a href="{% url 'sales_page' %}" class="tag">Trang sức vàng ưu đãi 25%</a>
              <a href="{% url 'sales_page' %}" class="tag">Trang sức vàng ưu đãi 40%</a>
            </div>
          </div>
          <div class="rank-search">
            <div class="box">
              <img
                src="https://cdn.pnj.io/images/image-update/layout/mobile/mui_ten.svg"
                alt=""
                class="icon-search"
                style="width: 15px; height: auto"
              />
              <span>Top tìm kiếm</span>
            </div>
            <a href="{% url 'sales_page' %}" class="tag">Hàng Mới </a
            ><a href="#" class="tag">Nhẫn Cưới </a
            ><a href="#" class="tag">Vòng Cổ</a>
          </div>
          <div class="service-hot">
            <div class="box">
              <img
                src="https://cdn.pnj.io/images/image-update/layout/mobile/hot.svg"
                alt=""
                class="icon-search"
                style="width: 15px; height: auto"
              />
              <span>Dịch vụ hot</span>
            </div>
            <a class="tag" href="{% url 'gift_page' %}" class="gift">Phiếu quà tặng</a>
          </div>
          <div class="branch-search">
            <div class="box">
              <img
                src="https://cdn.pnj.io/images/image-update/searchbar/brand_icon.svg"
                alt=""
                class="icon-search"
                style="width: 15px; height: auto"
              />
              <span>Thương hiệu nổi bật</span>
            </div>
            <a href="#"
              ><img
                src="https://cdn.pnj.io/images/image-update/searchbar/style.svg"
                alt=""
                class="image-branch" /></a
            ><a href="#"
              ><img
                src="https://cdn.pnj.io/images/image-update/searchbar/disney.svg"
                alt=""
                class="image-branch"
            /></a>
          </div>
          <div class="product-top">
            <div class="box">
              <img
                src="https://cdn.pnj.io/images/image-update/layout/mobile/tim_kiem.svg"
                alt=""
                class="icon-search"
                style="width: 15px; height: auto"
              />
              <span>Sản phẩm được tìm kiếm nhiều nhất</span>
            </div>
            <div class="wrap">
              {% for product in top_products %}
              <div class="detail">
                <a href="{% url 'details_page' product.ProductID%}" style="display: inline; text-align: center; margin-top: 20px; color: black;">
                  <img
                  src="{{ product.image.url }}"
                  alt="{{ product.Pname }}"
                  style="width: 80px; height: auto"
                  />
                  <p>{{ product.Pname }}</p>
                  <span class="price">{{ product.price }}đ</span>
                  <p>Lượt xem: {{ product.search_count }}</p>
                  </a>
              </div>
              {% empty %}
              <p>Không có sản phẩm nào.</p>
              {% endfor %}
            </div>
          </div>
        </div>
        <div class="search-sub" id="search-results">
          <!-- {% for product in top_products %}
          <div class="content-search">
            <a href="{{% url 'details_page' product.ProductID%}" style="display: inline-flex; justify-content: space-around;">
              <img
                style="width: 80px; height: auto"
                src="{{ product.image.url }}" alt="{{ product.Pname }}"
              />
              <div class="title-product">
                <span class="name-product">{{ product.Pname }}</span>
                <div class="detail-product">
                  <span class="price">{{ product.price }}đ</span>
                  <span class="stock">{{ product.search_count }} đã xem</span>
                </div>
              </div>
            </a> -->
          </div>
          <!-- {% endfor %} -->
        </div>
      </div>
</div>
<!-- End Search -->






<!-- Hien sp thanh tim kiemkiem -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let searchInput = document.getElementById("search-input");
        let searchResults = document.getElementById("search-results");
    
        searchInput.addEventListener("input", function () {
            let query = searchInput.value.trim();
            if (query.length < 2) {
                searchResults.innerHTML = "";  // Xóa kết quả khi không nhập gì
                return;
            }
    
            fetch(`/search/?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    searchResults.innerHTML = "";  // Xóa kết quả cũ
    
                    data.results.forEach(product => {
                        let item = document.createElement("div");
                        item.classList.add("content-search");
                        item.innerHTML = `
                            <a href="/details/${product.ProductID}/" style="display: inline-flex; justify-content: space-around;">
                                <img src="${product.image_url}" style="width: 80px; height: auto" alt="${product.Pname}">
                                <div class="title-product">
                                    <span class="name-product">${product.Pname}</span>
                                    <div class="detail-product">
                                        <span class="price">${product.price}đ</span>
                                        <span class="stock">${product.search_count} đã xem</span>
                                    </div>
                                </div>
                            </a>
                        `;
                        searchResults.appendChild(item);
                    });
                })
                .catch(error => console.error("Lỗi tìm kiếm:", error));
        });
    });
</script>
    